"use strict";var WFOTool=angular.module("WFOTool",["ngRoute","navigationComponent","planInputs","planOutputs","compare","home","testView","testComponent","messageService","restService","loaderService","conflictService","alertService"]);WFOTool.config(function($routeProvider){$routeProvider.when("/",{templateUrl:"modules/views/home/home.template.html"}).when("/home",{templateUrl:"modules/views/home/home.template.html"}).when("/input",{templateUrl:"modules/views/planInputs/planInputs.template.html",reloadOnSearch:!1}).when("/output",{templateUrl:"modules/views/planOutputs/planOutputs.template.html"}).when("/compare",{templateUrl:"modules/views/compare/compare.template.html"}).when("/test",{templateUrl:"modules/views/testView/testView.template.html"}).otherwise("/")}),WFOTool.controller("WFOToolCtrl",function($scope,$rootScope,$location,loaderService){function init(){loaderService.removeLoader()}$rootScope.workingPlan={},($scope.init=init)()});var navigationComponent=angular.module("navigationComponent",[]).directive("navigationComponent",function(){return{link:function(scope,element,attrs){scope.navigationComponentHTML=function(){var path={url:"modules/components/navigationComponent/navigationComponent.template.html"};return path.url}},restrict:"A",template:'<div ng-include="navigationComponentHTML()"></div>'}}).controller("navigationComponentCtrl",function($scope,$rootScope,$route,$location,messageService){function initiateFirstNav(){$scope.path=$route.current.$$route.originalPath.replace("/",""),$route.current.params.step?$scope.pathParams.step=$route.current.params.step:$scope.pathParams.step=""}function generateListeners(){$scope.$on("$routeChangeSuccess",function($event,next,current){$scope.path=next.$$route.originalPath.replace("/",""),next.params.step?$scope.pathParams.step=next.params.step:$scope.pathParams.step=""}),$scope.$on("changeStep",function($event,data){$scope.pathParams.step=data?data.step:"",-1!==window.location.hash.indexOf("?")?window.location.hash=window.location.hash.split("?")[0]+"?step="+data.step:window.location.hash=window.location.hash+"?step="+data.step,$scope.$$phase||$scope.$apply()})}function init(){console.log("navigationComponent module"),generateListeners(),initiateFirstNav()}$scope.path="",$scope.pathParams={step:""},$scope.init=init,$scope.generateListeners=generateListeners,$scope.initiateFirstNav=initiateFirstNav,$scope.navigateTo=function(loc){"home"===loc||"output"===loc||"compare"===loc?($location.path(loc),$scope.pathParams.step=""):-1===$route.current.$$route.originalPath.indexOf("input")?($location.path("input"),setTimeout(function(){messageService.broadcastMessage("changeStep",{step:loc})},500)):messageService.broadcastMessage("changeStep",{step:loc})},init()}),testComponent=angular.module("testComponent",[]).directive("testComponent",function(){return{link:function(scope,element,attrs){scope.testComponentHTML=function(){var path={url:"modules/components/testComponent/testComponent.template.html"};return path.url}},restrict:"A",template:'<div ng-include="testComponentHTML()"></div>'}}).controller("testComponentCtrl",function($scope,$rootScope){function init(){console.log("testComponent module")}$scope.data={},$scope.data.distance=0,$scope.data.speed=0,$scope.data.tank_size=0,$scope.testReturnData,$scope.init=init,$scope.testRest=function(paramObj){$.ajax({url:"https://6w0kmteji2.execute-api.us-east-1.amazonaws.com/test/test_WFOTravelMath",type:"GET",data:paramObj,contentType:"application/json",success:function(data){console.log(data),$scope.testReturnData=data.body,$scope.$apply()},failure:function(err){return err}})},init()});function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}var compare=angular.module("compare",[]).directive("compare",function(){return{link:function(scope,element,attrs){scope.compareHTML=function(){var path={url:"modules/view/compare/compare.template.html"};return path.url}},restrict:"A",template:'<div ng-include="compareHTML()"></div>'}}).controller("compareCtrl",function($scope,$rootScope,$route,restService,loaderService,alertService){function generateIndicators(plans){if(1<plans.length){$scope.indicators.max_revenue=Math.max.apply(Math,_toConsumableArray(plans.map(function(d){return+d.summary_metrics.revenue}).filter(function(p){return!isNaN(p)}))),$scope.indicators.max_cost=Math.max.apply(Math,_toConsumableArray(plans.map(function(d){return+d.summary_metrics.cost}).filter(function(p){return!isNaN(p)}))),$scope.indicators.max_roi_percent=Math.max.apply(Math,_toConsumableArray(plans.map(function(d){return+d.summary_metrics.roi_percent}).filter(function(p){return!isNaN(p)}))),$scope.indicators.max_success_rate=Math.max.apply(Math,_toConsumableArray(plans.map(function(d){return+d.summary_metrics.success_rate}).filter(function(p){return!isNaN(p)})));var nums={rev:0,cost:0,roi:0,suc:0};plans.forEach(function(p,i,a){p.summary_metrics.revenue==$scope.indicators.max_revenue&&nums.rev++,p.summary_metrics.cost==$scope.indicators.max_cost&&nums.cost++,p.summary_metrics.roi_percent==$scope.indicators.max_roi_percent&&nums.roi++,p.summary_metrics.success_rate==$scope.indicators.max_success_rate&&nums.suc++}),nums.rev===plans.length&&($scope.indicators.max_revenue=""),nums.cost===plans.length&&($scope.indicators.max_cost=""),nums.roi===plans.length&&($scope.indicators.max_roi_percent=""),nums.suc===plans.length&&($scope.indicators.max_success_rate=""),$scope.$apply()}}function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function getSavedPlans(){loaderService.createLoader("Loading"),restService.getSavedPlans().then(function(data){try{$scope.planOptions=data.body.Items,$scope.planOptions.sort(function(a,b){return a.title>b.title?1:a.title<b.title?-1:0}),$scope.$apply(),loaderService.removeLoader()}catch(error){console.error(error),loaderService.removeLoader(),$scope.$apply()}}).catch(function(err){loaderService.removeLoader(),alertService.createServerError(),console.error(err)})}function init(){console.log("compare module"),getSavedPlans()}$scope.plansToCompare=[{},{},{}],$scope.plansSelected=[],$scope.indicators={},$scope.planOptions=[],$scope.init=init,$scope.getSavedPlans=getSavedPlans,$scope.getComparedPlan=function(idx,plan){loaderService.createLoader("Selecting plan to compare to..."),restService.getOutputsByInputId({plan_inputs_id:JSON.parse(plan).plan_inputs_id}).then(function(data){for(var key in loaderService.removeLoader(),$scope.plansSelected[idx]=data.body.Items[0],$scope.plansSelected[idx].summary_metrics)$scope.plansSelected[idx].summary_metrics[key+"_disp"]=numberWithCommas($scope.plansSelected[idx].summary_metrics[key]);$scope.$apply(),generateIndicators($scope.plansSelected)}).catch(function(err){loaderService.removeLoader(),alertService.createServerError(),console.error(err)})},$scope.numberWithCommas=numberWithCommas,$scope.generateIndicators=generateIndicators,init()}),home=angular.module("home",[]).directive("home",function(){return{link:function(scope,element,attrs){scope.homeHTML=function(){var path={url:"modules/view/home/home.template.html"};return path.url}},restrict:"A",template:'<div ng-include="homeHTML()"></div>'}}).controller("homeCtrl",function($scope,$rootScope){function init(){console.log("home module")}($scope.init=init)()}),planInputs=angular.module("planInputs",[]).directive("planInputs",function(){return{link:function(scope,element,attrs){scope.planInputsHTML=function(){var path={url:"modules/view/planInputs/planInputs.template.html"};return path.url}},restrict:"A",template:'<div ng-include="planInputsHTML()"></div>'}}).controller("planInputsCtrl",function($scope,$rootScope,$location,messageService,$timeout,restService,loaderService,conflictService,alertService){function workersScroll_checkOverflow(){var workers=document.getElementById("workers");return!!workers&&workers.clientWidth-workers.scrollWidth<0}function workersScroll_scroll(dir,_int){var distance=Number;_int?(distance=_int,"left"===dir&&(distance=-_int)):(distance=40,"left"===dir&&(distance=-40));var ele=document.getElementById("workers");ele.scrollLeft=ele.scrollLeft+distance}function selectSavedPlan_close(){$scope.selectSavedPlanModalShown=!1,$scope.selectedSavedPlan={}}function addWorkerType_close(){$scope.addWorkerModalShown=!1,$scope.newWorker.title="",$scope.newWorker.fte=0,$scope.newWorker.burnRate=0}function addConstraint_close(){$scope.addConstraintModalShown=!1,$scope.newConstraint.case_type="",$scope.newConstraint.comparator="",$scope.newConstraint.volume=0}function addRule_close(){$scope.addRuleModalShown=!1,$scope.newRule.comparator="",$scope.newRule.percent=0,$scope.newRule.worker="",$scope.newRule.case_type=""}function deleteRule_close(){$scope.deleteRuleModalShown=!1,$scope.ruleToDelete={}}function getPlans_default(){if(localStorage.getItem("_WFOTool_workingPlan")){var d=JSON.parse(localStorage.getItem("_WFOTool_workingPlan"));return $scope.inputData.fte={},$scope.inputData.ai={},Object.keys(d.fte).sort().forEach(function(key){$scope.inputData.fte[key]={},Object.keys(d.fte[key]).forEach(function(key_){$scope.inputData.fte[key][key_]=d.fte[key][key_]})}),Object.keys(d.ai).sort().forEach(function(key){$scope.inputData.ai[key]={},Object.keys(d.ai[key]).forEach(function(key_){$scope.inputData.ai[key][key_]=d.ai[key][key_]})}),Object.keys(d).sort().forEach(function(key){"fte"!==key&&"ai"!==key&&($scope.inputData[key]=d[key])}),$scope.inputData_rigid=JSON.parse(JSON.stringify($scope.inputData)),console.log($scope.inputData),$timeout(function(){generateListeners_scroll()},250),loaderService.removeLoader(),null}restService.getDefaultPlan().then(function(data){var d=JSON.parse(JSON.stringify(data.body));return $scope.inputData.fte={},$scope.inputData.ai={},Object.keys(d.fte).sort().forEach(function(key){$scope.inputData.fte[key]={},Object.keys(d.fte[key]).forEach(function(key_){$scope.inputData.fte[key][key_]=d.fte[key][key_]})}),Object.keys(d.ai).sort().forEach(function(key){$scope.inputData.ai[key]={},Object.keys(d.ai[key]).forEach(function(key_){$scope.inputData.ai[key][key_]=d.ai[key][key_]})}),Object.keys(d).sort().forEach(function(key){"fte"!==key&&"ai"!==key&&($scope.inputData[key]=d[key])}),$scope.inputData_rigid=JSON.parse(JSON.stringify($scope.inputData)),$scope.$apply(),$timeout(function(){generateListeners_scroll()},250),localStorage.setItem("_WFOTool_workingPlan",JSON.stringify(data.body)),loaderService.removeLoader(),null}).catch(function(err){return loaderService.removeLoader(),alertService.createServerError(),console.error(err),null})}function getPlans_savedPlans(){restService.getSavedPlans().then(function(data){data.body.Items.forEach(function(plan,idx,arr){$scope.savedPlans[idx]={},$scope.savedPlans[idx].fte={},$scope.savedPlans[idx].ai={},Object.keys(plan.fte).sort().forEach(function(key){$scope.savedPlans[idx].fte[key]={},Object.keys(plan.fte[key]).forEach(function(key_){$scope.savedPlans[idx].fte[key][key_]=plan.fte[key][key_]})}),Object.keys(plan.ai).sort().forEach(function(key){$scope.savedPlans[idx].ai[key]={},Object.keys(plan.ai[key]).forEach(function(key_){$scope.savedPlans[idx].ai[key][key_]=plan.ai[key][key_]})}),Object.keys(plan).sort().forEach(function(key){"fte"!==key&&"ai"!==key&&($scope.savedPlans[idx][key]=plan[key])})}),$scope.$apply(),restService.getDefaultPlan().then(function(d_){var d=JSON.parse(JSON.stringify(d_.body)),_d={fte:{},ai:{}};Object.keys(d.fte).sort().forEach(function(key){_d.fte[key]={},Object.keys(d.fte[key]).forEach(function(key_){_d.fte[key][key_]=d.fte[key][key_]})}),Object.keys(d.ai).sort().forEach(function(key){_d.ai[key]={},Object.keys(d.ai[key]).forEach(function(key_){_d.ai[key][key_]=d.ai[key][key_]})}),Object.keys(d).sort().forEach(function(key){"fte"!==key&&"ai"!==key&&(_d[key]=d[key])}),$scope.savedPlans.push(d),console.log($scope.savedPlans)}).catch(function(err){return loaderService.removeLoader(),alertService.createServerError(),console.error(err),null})}).catch(function(err){loaderService.removeLoader(),alertService.createServerError(),console.error(err)})}function generateListeners_scroll(){document.getElementById("workers")&&document.getElementById("workers").addEventListener("scroll",function(e){document.getElementById("costs").scrollLeft=e.target.scrollLeft}),document.getElementById("costs")&&document.getElementById("costs").addEventListener("scroll",function(e){document.getElementById("workers").scrollLeft=e.target.scrollLeft})}function generateListeners(){$scope.$on("$routeChangeSuccess",function($event,next,current){next.params.step?$scope.step=next.params.step:$scope.step=""}),$scope.$on("changeStep",function($event,data){$scope.step=data.step,$scope.$$phase||$scope.$apply()}),window.addEventListener("resize",function(e){workersScroll_checkOverflow(),$scope.$$phase||$scope.$apply()})}function init(){console.log("planInputs module"),$location.$$search.step||($location.path("input"),setTimeout(function(){messageService.broadcastMessage("changeStep",{step:"FTE"})},500)),loaderService.createLoader("loading the default plan. . ."),generateListeners(),getPlans_default(),getPlans_savedPlans()}$scope.step="",$scope.stepsArr=["FTE","AvailableInventory","CaseConstraints","ResourceFlexibility"],$scope.inputData={},$scope.inputData_rigid={},$scope.validData=!0,$scope.savedPlans=[],$scope.selectSavedPlanModalShown=!1,$scope.selectedSavedPlan={},$scope.selectSavedPlanModalPreviewShown=!1,$scope.addWorkerModalShown=!1,$scope.newWorker={title:"",fte:0,burnRate:0},$scope.deleteConstraintModalShown=!1,$scope.constraintToDelete={},$scope.deleteRuleModalShown=!1,$scope.ruleToDelete={},$scope.addConstraintModalShown=!1,$scope.newConstraint={case_type:"",comparator:"",volume:0},$scope.addRuleModalShown=!1,$scope.newRule={comparator:"",percent:0,worker:"",case_type:""},$scope.comparators={"be less than":"<","not exceed":"<=",equal:"=","be more than":">","be at least":">="},$scope.comparatorsDisp={"be less than":"be less than","not exceed":"not exceed",equal:"equal","be more than":"be more than","be at least":"be at least"},$scope.flexiblityComparators={"Less than":"<","No more than":"<=",Exactly:"=","More than":">","At least":">="},$scope.flexiblityComparatorsDisp={"Less than":"Less than","No more than":"No more than",Exactly:"Exactly","More than":"More than","At least":"At least"},$scope.conflictObject={},$scope.conflicts=[],$scope.init=init,$scope.generateListeners=generateListeners,$scope.getPlans_default=getPlans_default,$scope.getPlans_savedPlans=getPlans_savedPlans,$scope.goToPrevStep=function(step){var newStepIdx=0;$scope.stepsArr.forEach(function(stp,idx,arr){step===stp&&(newStepIdx=idx-1,messageService.broadcastMessage("changeStep",{step:$scope.stepsArr[newStepIdx]}))})},$scope.goToNextStep=function(step){var newStepIdx=0;$scope.stepsArr.forEach(function(stp,idx,arr){step===stp&&(newStepIdx=idx+1,messageService.broadcastMessage("changeStep",{step:$scope.stepsArr[newStepIdx]}))})},$scope.runnablePlan=function(step){return"ResourceFlexibility"===step},$scope.validateData=function(data){if(data){var conflicts=conflictService.inputs.checkForConflicts(data,$scope.step,$scope.comparators,$scope.flexiblityComparators);return conflictService.alerts.createConflictAlert(conflicts.conflicts),!conflicts.exist}},$scope.validateStep=function(step,dir){},$scope.validateStep_arrows=function(step,dir){return("FTE"!==step||"prev"!==dir)&&("ResourceFlexibility"!==step||"next"!==dir)},$scope.addWorkerType=function(){$scope.addWorkerModalShown=!0},$scope.addWorkerType_submit=function(newWorker){var errors=[];for(var key in newWorker)"string"==typeof newWorker[key]?newWorker[key].length<1&&errors.push("worker name cannot be blank"):"number"==typeof newWorker[key]&&newWorker[key]<1&&errors.push(key+" cannot be 0");0<errors.length?errors.forEach(function(err){alertService.createAlert("failure",err,1e4)}):($scope.inputData.fte[newWorker.title]=JSON.parse(JSON.stringify(newWorker)),addWorkerType_close())},$scope.addWorkerType_close=addWorkerType_close,$scope.addConstraint=function(){$scope.addConstraintModalShown=!0},$scope.addConstraint_submit=function(newConstraint){var errors=[];for(var key in newConstraint)"string"==typeof newConstraint[key]?newConstraint[key].length<1&&errors.push(key+" cannot be blank"):"number"==typeof newConstraint[key]&&newConstraint[key]<1&&errors.push(key+"cannot be 0");0<errors.length?errors.forEach(function(err){alertService.createAlert("failure",err,1e4)}):($scope.inputData.cc.constraints.push(JSON.parse(JSON.stringify(newConstraint))),addConstraint_close())},$scope.addConstraint_close=addConstraint_close,$scope.addRule=function(){$scope.addRuleModalShown=!0},$scope.addRule_submit=function(newRule){var errors=[];for(var key in newRule)"string"==typeof newRule[key]?newRule[key].lenght<1&&errors.push(key+" cannot be blank"):"number"==typeof newRule[key]&&newRule[key]<1&&errors.push(key+" cannot be 0");0<errors.length?errors.forEach(function(err){alertService.createAlert("failure",err,5e3)}):($scope.inputData.rf.flexibility.push(JSON.parse(JSON.stringify(newRule))),addRule_close())},$scope.addRule_close=addRule_close,$scope.deleteConstraint=function(idx){$scope.deleteConstraintModalShown=!0,$scope.constraintToDelete=JSON.parse(JSON.stringify($scope.inputData.cc.constraints[idx])),$scope.constraintToDelete.idx=idx},$scope.deleteConstraint_submit=function(data){$scope.inputData.cc.constraints.splice(data.idx,1),$scope.deleteConstraintModalShown=!1,$scope.constraintToDelete={}},$scope.deleteConstraint_close=function(){$scope.deleteConstraintModalShown=!1,$scope.constraintToDelete={}},$scope.deleteRule=function(idx){$scope.deleteRuleModalShown=!0,$scope.ruleToDelete=JSON.parse(JSON.stringify($scope.inputData.rf.flexibility[idx])),$scope.ruleToDelete.idx=idx},$scope.deleteRule_submit=function(data){$scope.inputData.rf.flexibility.splice(data.idx,data.idx),deleteRule_close()},$scope.deleteRule_close=deleteRule_close,$scope.selectSavedPlan_open=function(){$scope.selectSavedPlanModalShown=!0},$scope.selectSavedPlan_selectPlan=function(plan){$scope.selectedSavedPlan&&$scope.selectedSavedPlan.id===plan.id?$scope.selectedSavedPlan={}:$scope.selectedSavedPlan=plan},$scope.selectSavedPlan_previewPlan=function(){$scope.selectSavedPlanModalPreviewShown=!0},$scope.selectSavedPlan_closePreview=function(){$scope.selectSavedPlanModalPreviewShown=!1},$scope.selectSavedPlan_uploadPlan=function(plan){JSON.stringify($scope.inputData)===JSON.stringify(plan)?alertService.createAlert("warning","Plan Already Selected",5e3):($scope.inputData_rigid=JSON.parse(JSON.stringify(plan)),$scope.inputData=JSON.parse(JSON.stringify(plan)),selectSavedPlan_close())},$scope.selectSavedPlan_close=selectSavedPlan_close,$scope.workersScroll_checkOverflow=workersScroll_checkOverflow,$scope.workersScroll_scroll=workersScroll_scroll,$scope.workersScroll_scrollHold=function(dir){$scope.scrollInterval=setInterval(function(){workersScroll_scroll(dir,2)},1)},$scope.workersScroll_scrollHoldUp=function(){clearInterval($scope.scrollInterval)},$scope.updateWorkingPlanSave=function(data){localStorage.setItem("_WFOTool_workingPlan",JSON.stringify(data))},$scope.runPlan=function(d){var data=JSON.parse(JSON.stringify(d));if(data.id)if(data.plan_inputs_id)JSON.stringify($scope.inputData_rigid)===JSON.stringify(data)?console.log("exact same plan run before"):(delete data.id,delete data.plan_inputs_id,data.created_by="temp_user",data.title="temp_title",loaderService.createLoader("Running this previously saved plan again"));else{if("admin"!==data.created_by||"Default Data"!==data.title)return alertService.createAlert("failure","something went wrong...",5e3),loaderService.removeLoader(),!1;JSON.stringify($scope.inputData_rigid)===JSON.stringify(data)?loaderService.createLoader("Running the default plan"):(delete data.id,data.created_by="temp_user",data.title="temp_title",loaderService.createLoader("Running your modified plan"))}else alertService.createAlert("failure","something really wrong happend.....",5e3),alert("something really wrong happend..... reloading the page.  cool?"),window.location.reload(),data.created_by="temp_user",data.title="temp_title";var today=new Date;data.created=JSON.stringify(today),data.modified=JSON.stringify(today),restService.runPlan(data).then(function(data){200===data.statusCode?($location.path("/output").search(encodeURI(JSON.stringify(data.body))),$scope.$apply(),alertService.createAlert("success","Your plan was successfully run!",2500)):418===data.statusCode?($location.path("/output").search(encodeURI(JSON.stringify(data.body))),$scope.$apply(),alertService.createAlert("warning","Your plan was run but returned a 418 error with some data showing errors (NaN)!",1e4)):data.errorMessage?alertService.createServerError(data.errorMessage):alertService.createServerError(),loaderService.removeLoader()}).catch(function(err){loaderService.removeLoader(),alertService.createServerError(),console.error(err)})},init()}),planOutputs=angular.module("planOutputs",[]).directive("planOutputs",function(){return{link:function(scope,element,attrs){scope.planOutputsHTML=function(){var path={url:"modules/view/planOutputs/planOutputs.template.html"};return path.url}},restrict:"A",template:'<div ng-include="planOutputsHTML()"></div>'}}).controller("planOutputsCtrl",function($scope,$rootScope,$route,$location,restService,loaderService,alertService){function numberWithCommas(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function savePlan_close(){$scope.savePlanData={},$scope.savePlanModalShown=!1,$scope.$apply()}function init(){if(loaderService.createLoader(),console.log("planOutputs module"),2<JSON.stringify($route.current.params).length)for(var key in $route.current.params)try{$scope.outputData=JSON.parse(key);var total=0;for(var _key in $scope.outputData.plan_details.forEach(function(row,idx,arr){idx<arr.length-1&&0<idx&&(total+=parseFloat(row[row.length-1]))}),$scope.outputData.plan_details[$scope.outputData.plan_details.length-1].push(total),console.log($scope.outputData),$scope.outputData.summary_metrics)$scope.outputData.summary_metrics[_key+"_disp"]=numberWithCommas($scope.outputData.summary_metrics[_key]);$scope.outputData.plan_details_disp=[],$scope.outputData.plan_details.forEach(function(row){var row_disp=[];row.forEach(function(col){var col_disp=numberWithCommas(col);row_disp.push(col_disp)}),$scope.outputData.plan_details_disp.push(row_disp)}),$scope.loaded.outputData=!0,loaderService.removeLoader()}catch(err){console.log(err)}else console.log("no parameters"),loaderService.removeLoader(),$location.path("/")}$scope.plan="",$scope.outputData={},$scope.loaded={outputData:!1},$scope.savePlanData={},$scope.savePlanModalShown=!1,$scope.init=init,$scope.savePlan=function(outputData){console.log(outputData),$scope.savePlanData={plan_outputs_id:outputData.id,plan_inputs_id:outputData.plan_inputs_id},$scope.savePlanData.title="",$scope.savePlanModalShown=!0},$scope.savePlan_submit=function(){loaderService.createLoader("Saving Your Plan");var now=new Date;$scope.savePlanData.created=JSON.stringify(now),$scope.savePlanData.modified=JSON.stringify(now),$scope.savePlanData.created_by="temp_user",restService.savePlan($scope.savePlanData).then(function(data){console.log(data),savePlan_close(),200===data.statusCode?(loaderService.removeLoader("Saved"),alertService.createAlert("success","Your plan was successfully saved!",3e3)):208===data.statusCode&&(loaderService.removeLoader("Plan is already Saved"),alertService.createAlert("warning","This plan was already saved",3e3))}).catch(function(err){loaderService.removeLoader(),alertService.createServerError(),console.error(err)})},$scope.savePlan_close=savePlan_close,$scope.downloadPlan=function(data){var d=JSON.parse(JSON.stringify(data)),tab1=[[],[]];for(var k in d.summary_metrics)-1!=k.indexOf("_disp")?delete d.summary_metrics[k]:(tab1[0].push(k),tab1[1].push(d.summary_metrics[k]));var tab2=d.plan_details,csvContent1="data:text/csv;charset=utf-8,"+tab1.map(function(e){return e.join(",")}).join("\n"),csvContent2="data:text/csv;charset=utf-8,"+tab2.map(function(e){return e.join(",")}).join("\n"),today=new Date;alertService.createAlert("success","Downloading the output data as two .csv files",5e3);var hiddenElement=document.createElement("a");hiddenElement.href=encodeURI(csvContent1),hiddenElement.target="_blank",hiddenElement.download=d.id+"_summaryMetrics"+today.toString()+".csv",hiddenElement.click();var hiddenElement2=document.createElement("a");hiddenElement2.href=encodeURI(csvContent2),hiddenElement2.target="_blank",hiddenElement2.download=d.id+"_planDetails"+today.toString()+".csv",hiddenElement2.click()},$scope.numberWithCommas=numberWithCommas,init()}),testView=angular.module("testView",[]).directive("testView",function(){return{link:function(scope,element,attrs){scope.testViewHTML=function(){var path={url:"modules/view/testView/testView.template.html"};return path.url}},restrict:"A",template:'<div ng-include="testViewHTML()"></div>'}}).controller("testViewCtrl",function($scope,$rootScope){$scope.boards=[],console.log("testView module")}),alertService=angular.module("alertService",[]).service("alertService",function($rootScope){var alertService=this;alertService.createAlert=function(type,msg,timer){var alertContainer=document.getElementById("__alert"),randID=Math.floor(1e4*Math.random()+1),newAlertHTML='            <div id="'+randID+'" class="alert '+type+'">                <div class="msg">'+msg+'</div>                <div class="close">'+('<button class="alert-close" onclick="document.getElementById(\''+randID+"').parentNode.removeChild(document.getElementById('"+randID+'\'))"><i class="fa fa-times"></i></button>')+"</div>            </div>            ";alertContainer.innerHTML+=newAlertHTML,setTimeout(function(){alertService.fadeoutAlert(randID),setTimeout(function(){alertService.deleteAlert(randID)},250)},timer)},alertService.createServerError=function(msg){var alertContainer=document.getElementById("__alert"),randID=Math.floor(1e4*Math.random()+1),closeAlert='<button class="alert-close" onclick="document.getElementById(\''+randID+"').parentNode.removeChild(document.getElementById('"+randID+'\'))"><i class="fa fa-times"></i></button>',newAlertHTML="";newAlertHTML=msg?'                <div id="'+randID+'" class="alert failure">                    <div class="msg">ERROR: A server error has occured</div>                    <div class="msg">'+msg+'</div>                    <div class="close">'+closeAlert+"</div>                </div>                ":'                <div id="'+randID+'" class="alert failure">                    <div class="msg">ERROR: An unknown server error has occured</div>                    <div class="msg">-</div>                    <div class="msg">Please refresh your browser</div>                    <div class="close">'+closeAlert+"</div>                </div>                ",alertContainer.innerHTML+=newAlertHTML,setTimeout(function(){alertService.fadeoutAlert(randID),setTimeout(function(){alertService.deleteAlert(randID)},250)},1e8)},alertService.fadeoutAlert=function(id){document.getElementById(id)&&document.getElementById(id).classList.add("fade-out")},alertService.deleteAlert=function(id){document.getElementById(id)&&document.getElementById(id).parentNode.removeChild(document.getElementById(id))}}),conflictService=angular.module("conflictService",[]).service("conflictService",function($rootScope){var _this=this,conflictService=this;conflictService.inputs={checkForConflicts:function checkForConflicts(data,step,cccomparators,rfcomparators){var return_object={conflicts:[],exist:!1},conflictObject=JSON.parse(JSON.stringify(data));for(var key in conflictObject)if("string"==typeof conflictObject[key])conflictObject[key]="";else for(var key_ in conflictObject[key])if(conflictObject[key][key_].length)conflictObject[key][key_].forEach(function(o,i,a){for(var k in o)o[k]=""});else for(var key__ in conflictObject[key][key_])conflictObject[key][key_][key__]="";return data.cc.constraints.forEach(function(cont,idx,arr){var equation=data.ai[cont.case_type].cases+cccomparators[cont.comparator]+cont.volume;eval(equation)||return_object.conflicts.push({step:"Case Constraints",id:idx,conflictString:"A conflict exists with "+data.ai[cont.case_type].title+" and item "+(idx+1),case:data.ai[cont.case_type].title}),arr.forEach(function(cont_,idx_,arr_){idx!==idx_&&cont.case_type===cont_.case_type&&(">"===cccomparators[cont.comparator]?"="!==cccomparators[cont_.comparator]&&"<="!==cccomparators[cont_.comparator]&&"<"!==cccomparators[cont_.comparator]||cont.volume>=cont_.volume&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_)):">="===cccomparators[cont.comparator]?"<"!==cccomparators[cont_.comparator]&&"<="!==cccomparators[cont_.comparator]&&"="!==cccomparators[cont_.comparator]||cont.volume!==cont_.volume&&cont.volume>cont_.volume&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_)):"="===cccomparators[cont.comparator]?"="===cccomparators[cont_.comparator]?cont.volume!==cont_.volume&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_)):">"===cccomparators[cont_.comparator]?(cont.volume<cont_.volume||cont.volume===cont_.volume)&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_)):">="===cccomparators[cont_.comparator]?cont.volume<cont_.volume&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_)):"<"===cccomparators[cont_.comparator]?(cont.volume>cont_.volume||cont.volume===cont_.volume)&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_)):"<"===cccomparators[cont_.comparator]?(cont.volume>cont_.volume||cont.volume===cont_.volume)&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_)):cccomparators["<="===cont_.comparator]&&cont.volume>cont_.volume&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):"<="===cccomparators[cont.comparator]?">"!==cccomparators[cont_.comparator]&&">="!==cccomparators[cont_.comparator]&&"="!==cccomparators[cont_.comparator]||cont.volume!==cont_.volume&&cont.volume<cont_.volume&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_)):"<"===cccomparators[cont.comparator]&&(">"!==cccomparators[cont_.comparator]&&">="!==cccomparators[cont_.comparator]&&"="!==cccomparators[cont_.comparator]||cont.volume<cont_.volume&&(return_object=_this.inputs.createCCConflictObject(return_object,idx,idx_))))})}),data.rf.flexibility.forEach(function(flex,idx,arr){var totalWorkerHours=2e3*data.fte[flex.worker].fte*(flex.percent/100),availableCaseHours=data.ai[flex.case_type].cases*data.ai[flex.case_type].hours,comparator="exactly"===flex.comparator.toLowerCase()?"===":rfcomparators[flex.comparator],equation=availableCaseHours+comparator+totalWorkerHours;eval(equation)||return_object.conflicts.push({step:"Resource Flexibility",id:idx,conflictString:"A conflict exists with "+data.fte[flex.worker].title+" and item "+(idx+1),worker:data.fte[flex.worker].title}),arr.forEach(function(flex_,idx_,arr_){idx!==idx_&&flex.worker===flex_.worker&&flex.case_type===flex_.case_type&&(">"===rfcomparators[flex.comparator]?"="!==rfcomparators[flex_.comparator]&&"<="!==rfcomparators[flex_.comparator]&&"<"!==rfcomparators[flex_.comparator]||flex.percent>=flex_.percent&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):">="===rfcomparators[flex.comparator]?"<"!==rfcomparators[flex_.comparator]&&"<="!==rfcomparators[flex_.comparator]&&"="!==rfcomparators[flex_.comparator]||flex.percent!==flex_.percent&&flex.percent>flex_.percent&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):"="===rfcomparators[flex.comparator]?"="===rfcomparators[flex_.comparator]?flex.percent!==flex_.percent&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):">"===rfcomparators[flex_.comparator]?(flex.percent<flex_.percent||flex.percent===flex_.percent)&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):">="===rfcomparators[flex_.comparator]?flex.percent<flex_.percent&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):"<"===rfcomparators[flex_.comparator]?(flex.percent>flex_.percent||flex.percent===flex_.percent)&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):"<"===rfcomparators[flex_.comparator]?(flex.percent>flex_.percent||flex.percent===flex_.percent)&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):rfcomparators["<="===flex_.comparator]&&flex.percent>flex_.percent&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):"<="===rfcomparators[flex.comparator]?">"!==rfcomparators[flex_.comparator]&&">="!==rfcomparators[flex_.comparator]&&"="!==rfcomparators[flex_.comparator]||flex.percent!==flex_.percent&&flex.percent<flex_.percent&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_)):"<"===rfcomparators[flex.comparator]&&(">"!==rfcomparators[flex_.comparator]&&">="!==rfcomparators[flex_.comparator]&&"="!==rfcomparators[flex_.comparator]||flex.percent<flex_.percent&&(return_object=_this.inputs.createRFConflictObject(return_object,idx,idx_))))})}),0<return_object.conflicts.length&&(return_object.conflicts.sort(function(a,b){return a.conflictString>b.conflitString?1:a.conflictString<b.conflictString?-1:0}),return_object.exist=!0),return_object},createRFConflictObject:function(obj,i,i_){return obj.conflicts.push({step:"Resource Flexibility",id:i,id_:i_,conflictString:"A conflict exists between rows "+(i+1)+" and "+(i_+1)}),obj},createCCConflictObject:function(obj,i,i_){return obj.conflicts.push({step:"Case Constraints",id:i,id_:i_,conflictString:"A conflict exists between rows "+(i+1)+" and "+(i_+1)}),obj}},conflictService.alerts={createConflictAlert:function(conflictArr){var conflictEle=document.getElementById("conflictAlerts"),html="",htmlclick="";conflictArr.forEach(function(a){a.worker||a.case?a.worker?htmlclick="                            if (window.location.href.indexOf('"+a.step.replace(/ /g,"")+"') !== -1) {                                document.getElementById('"+a.id+"').classList.add('highlight');                            } else if (window.location.href.indexOf('FTE') !== -1) {                                document.getElementsByClassName('"+a.worker.replace("Worker","")+"')[0].classList.add('highlight');                                document.getElementsByClassName('"+a.worker.replace("Worker","")+"')[1].classList.add('highlight');                            }":a.case&&(htmlclick="                            if (window.location.href.indexOf('"+a.step.replace(/ /g,"")+"') !== -1) {                                document.getElementById('"+a.id+"').classList.add('highlight');                            } else if (window.location.href.indexOf('AvailableInventory') !== -1) {                                document.getElementsByClassName('"+a.case.replace("Case Type","")+"')[0].classList.add('highlight');                                document.getElementsByClassName('"+a.case.replace("Case Type","")+"')[1].classList.add('highlight');                            }"):htmlclick="                        if (window.location.href.indexOf('"+a.step.replace(/ /g,"")+"') !== -1) {                            document.getElementById('"+a.id+"').classList.add('highlight');                            document.getElementById('"+a.id_+"').classList.add('highlight');                        }",html+='<div class="conflict" onclick="'+htmlclick+'">                                '+a.conflictString+" in "+a.step+"                            </div>"}),conflictEle.innerHTML="",conflictEle.innerHTML=html,_this.alerts.checkForConflictHighlights()},checkForConflictHighlights:function(){setInterval(function(){var highlightedEles=document.querySelectorAll(".highlight");if(0<highlightedEles.length)for(var i=0;i<highlightedEles.length;i++)_this.alerts.clearHighlight(highlightedEles[i])},500)},clearHighlight:function(ele){setTimeout(function(){ele.classList.remove("highlight")},5e3)}}}),loaderService=angular.module("loaderService",[]).service("loaderService",function($rootScope){this.createLoader=function(msg){document.getElementById("wfoLoader").style.display="block",clearTimeout($rootScope.LoaderTimeout);var text="";text=msg||"Loading . . .";var ani=document.getElementById("wfoLoaderShowbox"),txt=document.getElementById("wfoLoaderTextbox");ani.innerHTML='<div class="loader">                    <svg class="circular"                        viewBox="25 25 50 50">                        <circle class="path loading"                            cx="50" cy="50" r="20"                                fill="none"                                stroke-width="2"                                stroke-miterlimit="10" />                    </svg>            </div>',txt.textContent=text},this.removeLoader=function(msg){$rootScope.LoaderTimeout=setTimeout(function(){var ani=document.getElementById("wfoLoaderShowbox"),txt=document.getElementById("wfoLoaderTextbox"),loadedText="";loadedText=msg&&0<msg.length?"Loaded":msg,ani.innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 130.2 130.2" class="ld">                    <circle class="path circle" fill="none" stroke="#73AF55" stroke-width="6" stroke-miterlimit="10" cx="65.1" cy="65.1" r="62.1"/>                    <polyline class="path check" fill="none" stroke="#73AF55" stroke-width="6" stroke-linecap="round" stroke-miterlimit="10" points="100.2,40.2 51.5,88.8 29.8,67.5 "/>                </svg>',txt.textContent=loadedText,setTimeout(function(){document.getElementById("wfoLoader").classList.add("fadeout"),setTimeout(function(){var ani=document.getElementById("wfoLoaderShowbox"),txt=document.getElementById("wfoLoaderTextbox");ani.innerHTML="",txt.textContent="",document.getElementById("wfoLoader").style.display="none",document.getElementById("wfoLoader").classList.remove("fadeout")},250)},400)},300)}}),messageService=angular.module("messageService",[]).service("messageService",function($rootScope){this.broadcastMessage=function(msg,data){$rootScope.$broadcast(msg,data)}}),restService=angular.module("restService",[]).service("restService",function($rootScope){this.runPlan=function(data){return $.ajax({url:"http://localhost:1000/run-plan",type:"POST",data:JSON.stringify(data),contentType:"application/json",success:function(d){return d},failure:function(err){return console.warn(err),err}})},this.savePlan=function(data){return $.ajax({url:"http://localhost:1000/save-plan",type:"POST",data:JSON.stringify(data),contentType:"application/json",success:function(d){return d},failure:function(err){return console.warn(err),err}})},this.getDefaultPlan=function(){return $.ajax({url:"http://localhost:1000/get-default-inputs",type:"GET",data:{id:"61761d46-06ed-11ea-bfb8-d8f2ca4be654"},contentType:"application/json",success:function(d){return d},failure:function(err){console.log(err)}})},this.getSavedPlans=function(data){return $.ajax({url:"http://localhost:1000/get-saved-plans",type:"GET",data:JSON.stringify(data),contentType:"application/json",success:function(d){return d},failure:function(err){console.log(err)}})},this.getOutputsByInputId=function(data){return $.ajax({url:"http://localhost:1000/get-output-plans",type:"GET",data:data,contentType:"application/json",success:function(d){return d},failure:function(err){console.log(err)}})}});